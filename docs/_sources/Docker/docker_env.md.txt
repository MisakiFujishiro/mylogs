# ç’°å¢ƒæ§‹ç¯‰ï¼ˆMacOSï¼‰
## Dockerã¨ã¯
ã‚³ãƒ³ãƒ†ãƒŠå‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œç’°å¢ƒã€‚  
Dockerã§ã¯IaC(ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚„å„ç¨®ç’°å¢ƒè¨­å®šã‚’ã‚³ãƒ¼ãƒ‰åŒ–ã—ã¦ç®¡ç†ã™ã‚‹ã“ã¨)ãŒå¯èƒ½ã€‚  
åˆ¥ç’°å¢ƒã§ã‚‚å®¹æ˜“ã«ç«‹ã¡ä¸Šã’ã‚‹ã“ã¨ãŒå¯èƒ½ãªã®ã§ã€ã‚¹ã‚¯ãƒ©ãƒƒãƒ—ãƒ»ãƒ“ãƒ«ãƒ‰ãŒå®¹æ˜“ã§é–‹ç™ºé€Ÿåº¦ã‚’é«˜ã‚ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚

## ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
[Dockerå…¬å¼ã‚µã‚¤ãƒˆ](https://docs.docker.com/desktop/install/mac-install/)ã‹ã‚‰ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã€‚  
MACOSã®å ´åˆã€CPUãŒIntelãƒãƒƒãƒ—ã‹M1ãƒãƒƒãƒ—ã§é¸æŠãŒç•°ãªã‚‹ã€‚  
PCã®ğŸãƒãƒ¼ã‚¯ã‹ã‚‰ã€Œã“ã®ãƒãƒƒã‚¯ã«ã¤ã„ã¦ã€ã‚’é¸æŠã€‚ãƒ—ãƒ­ã‚»ãƒƒã‚µã«ã€ŒIntelã€ã‚„ã€ŒM1ã€ã®è¨˜è¼‰ã‹ã‚‰åˆ¤æ–­ã™ã‚‹ã€‚è‡ªåˆ†ã®PCã¯M1ãªã®ã§M1ã‚’DL
ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãªã©ã‚’å…¥åŠ›ã—ã¦ã€ä¸Šéƒ¨ã«Dockerã®ã‚¢ã‚¤ã‚³ãƒ³ãŒè¡¨ç¤ºã•ã‚ŒãŸã‚‰æˆåŠŸ

## Springã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ã‚³ãƒ³ãƒ†ãƒŠåŒ–ã™ã‚‹
æœ€çµ‚çš„ãªãƒ•ã‚©ãƒ«ãƒ€æ§‹æˆ
```
â”œâ”€â”€ src/main/java
    â””â”€â”€ helloController.java
â”œâ”€â”€ src/main/resources
    â””â”€â”€ index.html
â”œâ”€â”€ Dockerfile
â””â”€â”€ pom.xml
```

### Spring Bootã§Hello World
- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒšã‚¤ãƒ³ã‹ã‚‰ã€Create new Spring Starter Projectã‚’é¸æŠ
- Nameã¯demoã«è¨­å®š
- Typeã‚’MavePJã«å¤‰æ›´
- Webã‹ã‚‰SpringWebã‚’é¸æŠ
- src/main/javaé…ä¸‹ã«HelloControllerã‚’ä½œæˆ
  - src/main/javaã‚’å³ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€Newã‹ã‚‰Classã‚’é¸æŠ
helloController.java
```
package com.example.demo;

import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.GetMapping;

@Controller
public class HelloController {

    @GetMapping("/hello")
	private String hello(){
		return "/index.html";
	}
}
  ```

- src/main/resourcesã«index.htmlã‚’ä½œæˆ
    - src/main/resourcesã‚’å³ã‚¯ãƒªãƒƒã‚¯ã—ã¦Newã‹ã‚‰Fileé¸æŠã—ã¦index.htmlã‚’ä½œæˆ

- SpringPJã®å®Ÿè¡Œ
  - DashBoardï¼ˆå·¦ä¸‹ï¼‰ã‹ã‚‰HellowWorldPJã‚’é¸æŠã—ã¦ã€Restart

- èµ·å‹•ç¢ºèª
  - [http://localhost:8080/hello](http://localhost:8080/hello)ã«ã‚¢ã‚¯ã‚»ã‚¹


### Hello Worldã‚’Dockerã‚³ãƒ³ãƒ†ãƒŠã«ã™ã‚‹
- pomãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä»¥ä¸‹ã§è¨˜è¿°
```
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd">
	<modelVersion>4.0.0</modelVersion>
	<parent>
		<groupId>org.springframework.boot</groupId>
		<artifactId>spring-boot-starter-parent</artifactId>
		<version>2.7.4</version>
		<relativePath/> <!-- lookup parent from repository -->
	</parent>
	<groupId>com.example</groupId>
	<artifactId>demo</artifactId>
	<version>0.0.1-SNAPSHOT</version>
	<name>demo</name>
	<description>Demo project for Spring Boot</description>
	
	<properties>
		<java.version>11</java.version>
	</properties>
	
	<dependencies>
		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-web</artifactId>
		</dependency>

		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-test</artifactId>
			<scope>test</scope>
		</dependency>
	</dependencies>

    <build>
        <finalName>app</finalName>
        <plugins>
            <plugin>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-maven-plugin</artifactId>
            </plugin>
        </plugins>
    </build>

</project>

```

- Dockerfileã®ä½œæˆ  
`docker build`ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€Dockerfileã®å†…å®¹ãŒé †æ¬¡å®Ÿè¡Œã•ã‚Œã‚‹

```
FROM maven:3.6.3-jdk-11 AS builder
WORKDIR /tmp
COPY ./src ./src
COPY ./pom.xml .
RUN mvn package
FROM adoptopenjdk/openjdk11:debianslim-jre
COPY --from=builder /tmp/target/app.jar /app/app.jar
EXPOSE 8080
ENTRYPOINT ["java", "-jar", "/app/app.jar"]
```
Dockerfileã§åˆ©ç”¨ã§ãã‚‹å„ç¨®ã‚³ãƒãƒ³ãƒ‰ã¨ãã®èª¬æ˜

| ã‚³ãƒãƒ³ãƒ‰       | å†…å®¹                   |
|------------|----------------------|
| FROM       | ã‚³ãƒ³ãƒ†ãƒŠã®ãƒ™ãƒ¼ã‚¹ã‚¤ãƒ¡ãƒ¼ã‚¸         |
| WORKDIR    | ä½œæ¥­ã‚’è¡Œã†ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª          |
| COPY       | ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸å†…ã«è¿½åŠ ã—ãŸã„ãƒ•ã‚¡ã‚¤ãƒ«  |
| RUN        | ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ä½œæˆæ™‚ã«å®Ÿè¡Œã™ã‚‹ã‚³ãƒãƒ³ãƒ‰ |
| EXPOSE     | ã‚³ãƒ³ãƒ†ãƒŠãŒListenã™ã‚‹ãƒãƒ¼ãƒˆ     |
| ENTRYPOINT | ã‚³ãƒ³ãƒ†ãƒŠå†…ã§å®Ÿè¡Œã™ã‚‹ã‚³ãƒãƒ³ãƒ‰       |

- docker buildã®å®Ÿè¡Œ
> docker image build -t [Docker Hubã®ãƒ¦ãƒ¼ã‚¶ãƒ¼åï¼ˆä»»æ„ï¼‰]/[ã‚¤ãƒ¡ãƒ¼ã‚¸åï¼ˆå¿…é ˆï¼‰]:[ã‚¿ã‚°ï¼ˆä»»æ„ï¼‰] [Dockerfileãƒ‘ã‚¹]

ä»Šå›ã¯ä»¥ä¸‹ã§å®Ÿè¡Œ
> docker image build -t spring-docker-demo:0.0.1 ./

- buildãŒå®Œäº†ã—ãŸã‚‰ã€ä½œæˆã•ã‚ŒãŸimageã®ç¢ºèª
> docker images

- ä½œæˆã—ãŸdockerã‚’å®Ÿè¡Œ
> docker run -it -p [ãƒ›ã‚¹ãƒˆå´ã®ãƒãƒ¼ãƒˆç•ªå·]:[ã‚³ãƒ³ãƒ†ãƒŠã®ãƒãƒ¼ãƒˆç•ªå·] [ã‚¤ãƒ¡ãƒ¼ã‚¸å]:[ã‚¿ã‚°]

ä»Šå›ã¯ä»¥ä¸‹ã§å®Ÿè¡Œ
> docker run -it -p 8080:8080 spring-docker-demo:0.0.1


## References
- [Dockerã¨ã¯](https://knowledge.sakura.ad.jp/13265/)
- [Dockerã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«](https://style.potepan.com/articles/34060.html#Docker_Visual_Studio_Code)
- [Springã§HelloWorld](https://searchman.info/java_eclipse/1130.html)
- [Springã‚’DockerImageã«å›ºã‚ã‚‹](https://qiita.com/saitoshi/items/a931399e81e63e8e4f1e)