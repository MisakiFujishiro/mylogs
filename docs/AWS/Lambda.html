
<!DOCTYPE html>

<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>7. Lambda &#8212; my_sphinx  ドキュメント</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/classic.css" />
    
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/translations.js"></script>
    
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="検索" href="../search.html" />
    <link rel="next" title="8. S3" href="S3.html" />
    <link rel="prev" title="6. API GateWay" href="apigw.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="総合索引"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="S3.html" title="8. S3"
             accesskey="N">次へ</a> |</li>
        <li class="right" >
          <a href="apigw.html" title="6. API GateWay"
             accesskey="P">前へ</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">my_sphinx  ドキュメント</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">7. </span>Lambda</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="lambda">
<h1><span class="section-number">7. </span>Lambda<a class="headerlink" href="#lambda" title="この見出しへのパーマリンク">¶</a></h1>
<p>サーバーのプロビジョニングや管理なしでプログラムを実行できるサービス</p>
<section id="id1">
<h2><span class="section-number">7.1. </span>Lambdaのメリット<a class="headerlink" href="#id1" title="この見出しへのパーマリンク">¶</a></h2>
<p>コードの実行やスケーリングをLambada側で実施するので、開発者はコーディングに集中できる。</p>
</section>
<section id="id2">
<h2><span class="section-number">7.2. </span>Lambdaの詳細<a class="headerlink" href="#id2" title="この見出しへのパーマリンク">¶</a></h2>
<section id="id3">
<h3><span class="section-number">7.2.1. </span>Lambda関数<a class="headerlink" href="#id3" title="この見出しへのパーマリンク">¶</a></h3>
<p>Lambdaで実行するソースコードとそのソースコードを実行するランタイムを合わせてLambda関数と呼ぶ</p>
</section>
<section id="id4">
<h3><span class="section-number">7.2.2. </span>環境設定<a class="headerlink" href="#id4" title="この見出しへのパーマリンク">¶</a></h3>
<p>アプリケーションの実行に必要なライブラリやパッケージをランタイムとして設定する。</p>
<p>CPUは設定することができないが、メモリスペックを設定することができる。</p>
<blockquote>
<div><p>Lambdaでは関数の実行時に使用できるメモリ量は128 MB～10,240 MB の値を 1 MB 単位で設定することができます。</p>
</div></blockquote>
</section>
<section id="id5">
<h3><span class="section-number">7.2.3. </span>同時実行数<a class="headerlink" href="#id5" title="この見出しへのパーマリンク">¶</a></h3>
<p>Lambdaのある時点における実行している関数の数を<code class="docutils literal notranslate"><span class="pre">同時実行数</span></code>と呼ぶ。
同時実行数は以下の式で算出する。</p>
<blockquote>
<div><p>同時実行=（1秒あたりの呼び出し数）x（平均実行時間（秒））</p>
</div></blockquote>
<p>Lambdaはリージョンごとに最大同時実行数が決まっており、これを超える同時実行数を同時に捌きたい場合は別途申請が必要となる。
東京の最大同時実行数は1000であり、Lambdaではリクエストとコンテナ数が1対1となるので、1000以上のリクエストを同時に捌きたい場合は申請が必要となる。</p>
</section>
<section id="id6">
<h3><span class="section-number">7.2.4. </span>環境変数<a class="headerlink" href="#id6" title="この見出しへのパーマリンク">¶</a></h3>
<p>Lambdaには環境変数を設定することができる。</p>
<p>環境変数はオプションとして、KMSによる暗号化が準備されており以下の暗号化が可能</p>
<ul class="simple">
<li><p>保管時の暗号化</p></li>
<li><p>伝送時の暗号化</p></li>
</ul>
<p><img alt="../_images/lambda_encryption.png" src="../_images/lambda_encryption.png" /></p>
</section>
<section id="id7">
<h3><span class="section-number">7.2.5. </span>Lambda関数のライフサイクル<a class="headerlink" href="#id7" title="この見出しへのパーマリンク">¶</a></h3>
<p>Lambdaの実態は、EC2(Amazon Linux)かDockerコンテナであり、以下の順序を踏んで実行される</p>
<ol class="simple">
<li><p>コンテナ作成</p></li>
<li><p>デプロイパッケージのロード</p></li>
<li><p>デプロイパッケージの展開</p></li>
<li><p>ランタイム起動</p></li>
<li><p>関数の実行</p></li>
<li><p>コンテナの破棄</p></li>
</ol>
<section id="id8">
<h4><span class="section-number">7.2.5.1. </span>ウォームスタート<a class="headerlink" href="#id8" title="この見出しへのパーマリンク">¶</a></h4>
<p>Lambdaに継続的なリクエストが飛んできている場合、1-4のプロセスはスキップされて、5から処理される。</p>
</section>
<section id="id9">
<h4><span class="section-number">7.2.5.2. </span>コールドスタート<a class="headerlink" href="#id9" title="この見出しへのパーマリンク">¶</a></h4>
<p>コンテナが不要と判断されると破棄されてしまうので、1番からやり直しとなる。</p>
</section>
<section id="provisioned-concurrency">
<h4><span class="section-number">7.2.5.3. </span>Provisioned Concurrency<a class="headerlink" href="#provisioned-concurrency" title="この見出しへのパーマリンク">¶</a></h4>
<p>性能要件が厳しい場合は、事前にプロビジョニングしておくことが可能</p>
</section>
</section>
<section id="id10">
<h3><span class="section-number">7.2.6. </span>バージョン<a class="headerlink" href="#id10" title="この見出しへのパーマリンク">¶</a></h3>
<p>Lambda関数はバージョニング機能があるが、バージョンとして公開されると編集することができない点に注意</p>
</section>
<section id="id11">
<h3><span class="section-number">7.2.7. </span>エイリアス<a class="headerlink" href="#id11" title="この見出しへのパーマリンク">¶</a></h3>
<p>エイリアスとはLambda関数の別名であり、prd,stg,devなどを設定できる。
エイリアスは同名で２つまで付与することができるので、エイリアスでルーティングをするとカナリアリリースを実現することができる。</p>
</section>
<section id="layers">
<h3><span class="section-number">7.2.8. </span>Layers<a class="headerlink" href="#layers" title="この見出しへのパーマリンク">¶</a></h3>
<p>複数のLambda関数が共通で利用するライブラリをZIPファイルで切り出して共有する機能
1つのLambda関数から最大5つのLayerを利用することができる。</p>
</section>
<section id="id12">
<h3><span class="section-number">7.2.9. </span>一時ファイル<a class="headerlink" href="#id12" title="この見出しへのパーマリンク">¶</a></h3>
<p>Lambdaは512MBの一時ファイルを<code class="docutils literal notranslate"><span class="pre">/tmp</span></code>として持つ。
注意が必要なのは、Lambdaが連続で起動している時に、tmpが共有されてしまうこと。</p>
<p><a class="reference external" href="https://cloud5.jp/lambda_tmp_directory/">Lambdaで/tmpディレクトリの利用</a></p>
</section>
<section id="url">
<h3><span class="section-number">7.2.10. </span>署名付きURL<a class="headerlink" href="#url" title="この見出しへのパーマリンク">¶</a></h3>
<p>AWS SDKやCLIを利用することでSTSの機能によって一時的にS3へアクセス可能なURLを発行させることができる。</p>
</section>
</section>
<section id="id13">
<h2><span class="section-number">7.3. </span>Lambdaの呼び出しかた分類<a class="headerlink" href="#id13" title="この見出しへのパーマリンク">¶</a></h2>
<p>Lambdaは呼び出し元のサービスによって、呼び出され方が異なる。</p>
<p><img alt="../_images/lambda_call.png" src="../_images/lambda_call.png" /></p>
<p>４つの種別については、以下のような分類がある。</p>
<p><img alt="../_images/lambda_call_detail.png" src="../_images/lambda_call_detail.png" />
大きな分類手である、ポーリングとはLambdaがイベントを取りに行くのか、呼ばれるのかの分類である。</p>
<section id="id14">
<h3><span class="section-number">7.3.1. </span>①Lambda関数を同期的に呼び出す<a class="headerlink" href="#id14" title="この見出しへのパーマリンク">¶</a></h3>
<p>Lambdaを呼び出したら、その実行が完了するのを待つ。<br />イベント元に実行結果を返す。</p>
<p>エラー発生時にはエラーがレスポンスされるので、CloudWatch Logsのサブスクリプションフィルタなどを利用する。<br />※S3のイベント契機をSQSで受け取ってLambdaがポーリングする場合同期処理になる点に注意。</p>
</section>
<section id="id15">
<h3><span class="section-number">7.3.2. </span>②Lambda関数を非同期的に呼び出す<a class="headerlink" href="#id15" title="この見出しへのパーマリンク">¶</a></h3>
<p>イベント型のAWSサービスは非同期となる(S3/SNS/CloudWatch Events/EventBridge)</p>
<p>Lambdaを呼び出すと、一旦Lambda内のQueueに格納されてからLambdaが実行される。
イベントソースには、キューへの格納成功だけが返されるので、結果は返されない。</p>
<p>エラー時の挙動はリトライ設定があるが、呼び出し元に通知はいかないので、デッドレターキューなどを利用する。</p>
<p><img alt="../_images/lambda_call_ansync.png" src="../_images/lambda_call_ansync.png" /></p>
</section>
<section id="id16">
<h3><span class="section-number">7.3.3. </span>③Lambdaがイベントを読み取る(イベントソースマッピング)<a class="headerlink" href="#id16" title="この見出しへのパーマリンク">¶</a></h3>
<p>Lambdaが新しいイベントがないがないかポーリングする。</p>
</section>
<section id="id17">
<h3><span class="section-number">7.3.4. </span>呼び出し方に応じたエラーハンドリング<a class="headerlink" href="#id17" title="この見出しへのパーマリンク">¶</a></h3>
<ul class="simple">
<li><p>同期処理の場合（1-a）<br />結果をそのままレスポンスに埋め込んで返却するので、CloudWatchに流れていく。
そのため、エラーに応じた通知などはLambdaをもう一つ作成して処理を作り込む必要がある。</p></li>
<li><p>非同期処理の場合(1-b)<br />イベントを受け付けると、Lambdaの処理中にエラーが発生しても2回リトライされる。
処理が以上終了しても呼び出し元へ通知はされないがその代わりデッドレターキューをSNSやSQSで定義することができる。この情報を利用して、通知の設定することが可能。</p></li>
</ul>
<p><img alt="../_images/lambda_errorhandling.png" src="../_images/lambda_errorhandling.png" /></p>
</section>
</section>
<section id="lambdas3aiaws">
<h2><span class="section-number">7.4. </span>LambdaとS3・AIなどのAWSサービスの連携<a class="headerlink" href="#lambdas3aiaws" title="この見出しへのパーマリンク">¶</a></h2>
<section id="h4b">
<h3><span class="section-number">7.4.1. </span>H4b<a class="headerlink" href="#h4b" title="この見出しへのパーマリンク">¶</a></h3>
<p><a class="reference external" href="https://pages.awscloud.com/JAPAN-event-OE-Hands-on-for-Beginners-Serverless-3-2022-confirmation_772.html">H4B：AWS LambdaとAWS AI Servicesを組み合わせて作る音声文字起こし&amp;感情分析パイプライン</a>
の内容を踏まえてLambadaの手順などを整理する。</p>
<section id="id18">
<h4><span class="section-number">7.4.1.1. </span>全体構成<a class="headerlink" href="#id18" title="この見出しへのパーマリンク">¶</a></h4>
<p>S3に音声データをアップロードするとS3のイベントが発出され、Lambdaがそれを受け取る。<br />LambdaがTranscribeを呼び出して、テキストデータに変換し、そのデータをS3にアップロードする。<br />テキストのアップロードを契機として、再度Lambdaを呼び出して、ポジネガ判定を行う。</p>
<ul class="simple">
<li><p>Polly:テキストから音声を生成するAIサービス</p></li>
<li><p>Transcribe:音声からテキストを生成するAIサービス</p></li>
<li><p>comprehend:文章のポジネガ判定を行うAIサービス</p></li>
</ul>
<p><img alt="../_images/lambda_archie.png" src="../_images/lambda_archie.png" /></p>
</section>
<section id="s3lambda">
<h4><span class="section-number">7.4.1.2. </span>S3とLambdaの連携<a class="headerlink" href="#s3lambda" title="この見出しへのパーマリンク">¶</a></h4>
<p><a class="reference internal" href="S3.html"><span class="doc">S3の手順書</span></a>に記載
S3バケットの作成をして、Lambdaからpython-get-s3-objectからコードを作成する。</p>
</section>
<section id="lambdatranscribe">
<h4><span class="section-number">7.4.1.3. </span>LambdaとTranscribeの連携<a class="headerlink" href="#lambdatranscribe" title="この見出しへのパーマリンク">¶</a></h4>
<p>Transcribeの基本的使い方は<a class="reference internal" href="AI.html"><span class="doc">AIのメモ</span></a>を確認。
S3内部の音声データのObjectを指定すると、文字起こしをして指定したs3のディレクトリにjsonファイルを吐き出す。</p>
<p>LambdaのIAM Roleについて、TranscribeやS3への権限を付与する</p>
<ul class="simple">
<li><p>transcribeFullAccess</p></li>
<li><p>S3FullAccess</p></li>
</ul>
<p>Lambdaの関数の中身を変更する。LambdaからAWSを呼び出すときは<a class="reference external" href="https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/transcribe.html">リファレンス</a>を参考にする<br />処理の中身はs3からデータを受け取って、Transcribeに連携、Transcribeの保存先にS3を指定</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">urllib.parse</span>
<span class="kn">import</span> <span class="nn">boto3</span>
<span class="kn">import</span> <span class="nn">datetime</span> <span class="c1"># jobuをユニークにするため</span>

<span class="c1"># s3のclient作成</span>
<span class="n">s3</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;s3&#39;</span><span class="p">)</span>
<span class="c1"># transcribeのclient作成</span>
<span class="n">transcribe</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;transcribe&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">lambda_handler</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="c1"># bucket名取得</span>
    <span class="n">bucket</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;Records&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;s3&#39;</span><span class="p">][</span><span class="s1">&#39;bucket&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
    <span class="c1"># object名取得</span>
    <span class="n">key</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">unquote_plus</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;Records&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;s3&#39;</span><span class="p">][</span><span class="s1">&#39;object&#39;</span><span class="p">][</span><span class="s1">&#39;key&#39;</span><span class="p">],</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
    
    <span class="k">try</span><span class="p">:</span>
         <span class="n">transcribe</span><span class="o">.</span><span class="n">start_transcription_job</span><span class="p">(</span>
            <span class="c1"># job名をユニークに設定</span>
            <span class="n">TranscriptionJobName</span><span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">%H%M%S&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_Transcription&#39;</span><span class="p">,</span>
            <span class="c1"># 日本語を対象に設定</span>
            <span class="n">LanguageCode</span><span class="o">=</span><span class="s1">&#39;ja-JP&#39;</span><span class="p">,</span>
            <span class="n">Media</span><span class="o">=</span><span class="p">{</span>
                <span class="c1"># 入力メディアのパス</span>
                <span class="s1">&#39;MediaFileUri&#39;</span><span class="p">:</span> <span class="s1">&#39;https://s3.ap-northeast-1.amazon.com/&#39;</span> <span class="o">+</span> <span class="n">bucket</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">key</span>
             <span class="p">},</span>
            <span class="c1"># 出力するs3バケットの情報[s3::]は不要</span>
            <span class="n">OutputBucketName</span><span class="o">=</span><span class="s1">&#39;bucket-h4b-serverless-output&#39;</span><span class="p">,</span>
            <span class="c1"># 出力するs3バケット内のディレクトリ</span>
            <span class="n">OutputKey</span> <span class="o">=</span> <span class="s1">&#39;transcribe-output/&#39;</span>
        <span class="p">)</span>    
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error getting object </span><span class="si">{}</span><span class="s1"> from bucket </span><span class="si">{}</span><span class="s1">. Make sure they exist and your bucket is in the same region as this function.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">bucket</span><span class="p">))</span>
        <span class="k">raise</span> <span class="n">e</span>
</pre></div>
</div>
<p>Lambdaファンクションを修正したら、Deployを忘れずに！</p>
</section>
<section id="s3">
<h4><span class="section-number">7.4.1.4. </span>S3への連携<a class="headerlink" href="#s3" title="この見出しへのパーマリンク">¶</a></h4>
<p>TranscribeがS3に格納したイベントを契機にして、Comprehendにデータを渡す。<br />Transcribeの基本的使い方は<a class="reference internal" href="AI.html"><span class="doc">AIのメモ</span></a>を確認。</p>
<ol class="simple">
<li><p>Lambdaの作成<br />前回同様に、S3へのファイルアップロードを契機とする。<br />アップロードされたjsonファイル飲みを対象とするので、Suffixで指定</p></li>
</ol>
<p><img alt="../_images/lambda_comprehend.png" src="../_images/lambda_comprehend.png" /></p>
<ol class="simple">
<li><p>IAMロールの修正</p>
<ul class="simple">
<li><p>S3FullAccess</p></li>
<li><p>ComprehendFullAccess</p></li>
</ul>
</li>
<li><p>Lambdaの修正<br />今回は感情分析の<code class="docutils literal notranslate"><span class="pre">detect_sentiment</span></code>関数を利用する。
関数の設定方法は<a class="reference external" href="https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/comprehend.html#Comprehend.Client.detect_sentiment">リファレンス</a>参照</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">urllib.parse</span>
<span class="kn">import</span> <span class="nn">boto3</span>

<span class="n">s3</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;s3&#39;</span><span class="p">)</span>
<span class="c1"># comprehendのクライアントを設定</span>
<span class="n">comprehend</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;comprehend&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">lambda_handler</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
    <span class="c1"># bucket名を取得</span>
    <span class="n">bucket</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;Records&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;s3&#39;</span><span class="p">][</span><span class="s1">&#39;bucket&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
    <span class="c1"># object名を取得</span>
    <span class="n">key</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">unquote_plus</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;Records&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;s3&#39;</span><span class="p">][</span><span class="s1">&#39;object&#39;</span><span class="p">][</span><span class="s1">&#39;key&#39;</span><span class="p">],</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># objectの中身を取得</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">s3</span><span class="o">.</span><span class="n">get_object</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="n">bucket</span><span class="p">,</span> <span class="n">Key</span><span class="o">=</span><span class="n">key</span><span class="p">)</span>
        
        <span class="c1"># jsonに変換</span>
        <span class="n">body</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;Body&#39;</span><span class="p">])</span>
        <span class="c1"># 中身からテキストを抽出</span>
        <span class="n">comprehend_text</span> <span class="o">=</span> <span class="n">body</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">][</span><span class="s1">&#39;transcripts&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;transcript&#39;</span><span class="p">]</span>
        
        <span class="c1"># 感情分析のAPI呼び出し</span>
        <span class="n">sentiment_response</span> <span class="o">=</span> <span class="n">comprehend</span><span class="o">.</span><span class="n">detect_sentiment</span><span class="p">(</span>
            <span class="n">Text</span><span class="o">=</span><span class="n">comprehend_text</span><span class="p">,</span>
            <span class="n">LanguageCode</span><span class="o">=</span><span class="s1">&#39;ja&#39;</span>
        <span class="p">)</span>
        
        <span class="c1"># 感情分析の結果からスコアを取得</span>
        <span class="n">sentiment_score</span> <span class="o">=</span> <span class="n">sentiment_response</span><span class="p">[</span><span class="s1">&#39;SentimentScore&#39;</span><span class="p">]</span>
        <span class="c1"># CloudWatchで確認できるようにprint</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">sentiment_score</span><span class="p">)</span>
        
        
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error getting object </span><span class="si">{}</span><span class="s1"> from bucket </span><span class="si">{}</span><span class="s1">. Make sure they exist and your bucket is in the same region as this function.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">bucket</span><span class="p">))</span>
        <span class="k">raise</span> <span class="n">e</span>
</pre></div>
</div>
</section>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../index.html">目次</a></h3>
    <ul>
<li><a class="reference internal" href="#">7. Lambda</a><ul>
<li><a class="reference internal" href="#id1">7.1. Lambdaのメリット</a></li>
<li><a class="reference internal" href="#id2">7.2. Lambdaの詳細</a><ul>
<li><a class="reference internal" href="#id3">7.2.1. Lambda関数</a></li>
<li><a class="reference internal" href="#id4">7.2.2. 環境設定</a></li>
<li><a class="reference internal" href="#id5">7.2.3. 同時実行数</a></li>
<li><a class="reference internal" href="#id6">7.2.4. 環境変数</a></li>
<li><a class="reference internal" href="#id7">7.2.5. Lambda関数のライフサイクル</a><ul>
<li><a class="reference internal" href="#id8">7.2.5.1. ウォームスタート</a></li>
<li><a class="reference internal" href="#id9">7.2.5.2. コールドスタート</a></li>
<li><a class="reference internal" href="#provisioned-concurrency">7.2.5.3. Provisioned Concurrency</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id10">7.2.6. バージョン</a></li>
<li><a class="reference internal" href="#id11">7.2.7. エイリアス</a></li>
<li><a class="reference internal" href="#layers">7.2.8. Layers</a></li>
<li><a class="reference internal" href="#id12">7.2.9. 一時ファイル</a></li>
<li><a class="reference internal" href="#url">7.2.10. 署名付きURL</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id13">7.3. Lambdaの呼び出しかた分類</a><ul>
<li><a class="reference internal" href="#id14">7.3.1. ①Lambda関数を同期的に呼び出す</a></li>
<li><a class="reference internal" href="#id15">7.3.2. ②Lambda関数を非同期的に呼び出す</a></li>
<li><a class="reference internal" href="#id16">7.3.3. ③Lambdaがイベントを読み取る(イベントソースマッピング)</a></li>
<li><a class="reference internal" href="#id17">7.3.4. 呼び出し方に応じたエラーハンドリング</a></li>
</ul>
</li>
<li><a class="reference internal" href="#lambdas3aiaws">7.4. LambdaとS3・AIなどのAWSサービスの連携</a><ul>
<li><a class="reference internal" href="#h4b">7.4.1. H4b</a><ul>
<li><a class="reference internal" href="#id18">7.4.1.1. 全体構成</a></li>
<li><a class="reference internal" href="#s3lambda">7.4.1.2. S3とLambdaの連携</a></li>
<li><a class="reference internal" href="#lambdatranscribe">7.4.1.3. LambdaとTranscribeの連携</a></li>
<li><a class="reference internal" href="#s3">7.4.1.4. S3への連携</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>前のトピックへ</h4>
    <p class="topless"><a href="apigw.html"
                          title="前の章へ"><span class="section-number">6. </span>API GateWay</a></p>
  </div>
  <div>
    <h4>次のトピックへ</h4>
    <p class="topless"><a href="S3.html"
                          title="次の章へ"><span class="section-number">8. </span>S3</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>このページ</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/AWS/Lambda.md.txt"
            rel="nofollow">ソースコードを表示</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">クイック検索</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="検索" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="総合索引"
             >索引</a></li>
        <li class="right" >
          <a href="S3.html" title="8. S3"
             >次へ</a> |</li>
        <li class="right" >
          <a href="apigw.html" title="6. API GateWay"
             >前へ</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">my_sphinx  ドキュメント</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">7. </span>Lambda</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2022, sphinx_user.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.2.3.
    </div>
  </body>
</html>