
<!DOCTYPE html>

<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>1. AWS &#8212; my_sphinx  ドキュメント</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/classic.css" />
    
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/translations.js"></script>
    
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="検索" href="../search.html" />
    <link rel="next" title="2. AWSのネットワーク" href="Network.html" />
    <link rel="prev" title="2. 塾の活動(FY23 上期)" href="../DAILY/FY23_MSA.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="総合索引"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="Network.html" title="2. AWSのネットワーク"
             accesskey="N">次へ</a> |</li>
        <li class="right" >
          <a href="../DAILY/FY23_MSA.html" title="2. 塾の活動(FY23 上期)"
             accesskey="P">前へ</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">my_sphinx  ドキュメント</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">1. </span>AWS</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="aws">
<h1><span class="section-number">1. </span>AWS<a class="headerlink" href="#aws" title="この見出しへのパーマリンク">¶</a></h1>
<section id="id1">
<h2><span class="section-number">1.1. </span>モダンアプリケーション<a class="headerlink" href="#id1" title="この見出しへのパーマリンク">¶</a></h2>
<p>モダンアプリケーションとは、<code class="docutils literal notranslate"><span class="pre">Appの設計構築管理を継続的に見直して、常に変化を受け入れられる準備をした開発戦略</span></code>である。
これによって、イノベーションのためのAppに対して、開発がボトルネックになることを避ける。</p>
<p>サーバーレスなアプリケーションやマイクロサービスアーキテクチャもモダンなアプリケーションの一つと言える。</p>
<p>AWSなどのパブリッククラウドを利用することで、モダンアプリケーションを構築することができる。</p>
<section id="id2">
<h3><span class="section-number">1.1.1. </span>モダンアプリケーションのメリット<a class="headerlink" href="#id2" title="この見出しへのパーマリンク">¶</a></h3>
<p>モダンアプリケーションにより、以下のようなメリットを得ることができる。</p>
<ul class="simple">
<li><p>何を作るか<br />マイクロサービスなど変化に強くイノベーションを促進するサービス</p></li>
<li><p>どう提供するか<br />CICDなど自動化された高速な市場投入</p></li>
<li><p>いくらかかるか<br />必要な料金だけ払う従量課金</p></li>
</ul>
</section>
<section id="id3">
<h3><span class="section-number">1.1.2. </span>モダンなアプリケーションのベストプラクティス<a class="headerlink" href="#id3" title="この見出しへのパーマリンク">¶</a></h3>
<p>2016年にPivotalが提唱した、クラウド開発における15のベストプラクティスである<code class="docutils literal notranslate"><span class="pre">Beyond</span> <span class="pre">the</span> <span class="pre">Twelve-Factor</span> <span class="pre">App</span></code>を踏まえたAppを開発することがベストプラクティスなモダンアプリケーション開発の一歩。15のベストプラクティスは以下で、詳細は<a class="reference external" href="https://blog.flinters.co.jp/entry/2023/02/20/120000">別記事</a>を参照。</p>
<ol class="simple">
<li><p>One codebase, one application （1コードベース、1アプリケーション）</p></li>
<li><p>API first（APIファースト）</p></li>
<li><p>Dependency management（依存関係管理）</p></li>
<li><p>Design, build, release, and run（デザイン、ビルド、リリース、実行）</p></li>
<li><p>Configuration, credentials, and code（設定、機密情報、コード）</p></li>
<li><p>Logs（ログ）</p></li>
<li><p>Disposability（廃棄容易性）</p></li>
<li><p>APIBacking services（バックエンドサービス）</p></li>
<li><p>Environment parity（環境一致）</p></li>
<li><p>Administrative processes（管理プロセス）</p></li>
<li><p>Port binding（ポートバインディング）</p></li>
<li><p>Stateless processes（ステートレスプロセス）</p></li>
<li><p>Concurrency（並行性）</p></li>
<li><p>Teremetry（テレメトリ）</p></li>
<li><p>Authentication and authorization（認証、認可）</p></li>
</ol>
</section>
<section id="id4">
<h3><span class="section-number">1.1.3. </span>データの可視化<a class="headerlink" href="#id4" title="この見出しへのパーマリンク">¶</a></h3>
<p>モダンアプリケーションに限らず、App開発において、<code class="docutils literal notranslate"><span class="pre">何を収集して、何を可視化するか</span></code>という可視化戦略は非常に重要。データを収集することで、システム内部で何が起きているか説明でき、今後のAppの方針を検討することができることが重要。</p>
<p>特にモダンアプリケーションはApp全体や特定サービスごとに取得するサービスも異なる。</p>
<p>収集するべきデータの種別としては以下の3つに分類できる。</p>
<ul class="simple">
<li><p>ビジネスデータ</p></li>
<li><p>運用データ</p></li>
<li><p>システムデータ</p></li>
</ul>
<p>■ビジネスデータ<br />経営陣が経営方針を判断するために必要なデータであり、何を収集するかについては、経営陣にヒアリングして決まる。ログを一箇所に集めておき、必要なデータをフィルタリングして収集するようなパターンが挙げられる。</p>
<p>■運用データ<br />サービスの運用状況を把握するために収集されるデータであり、開発と運用チームがサービスを改善していくために利用するデータ（アラームの発砲数など）</p>
<p>■システムデータ<br />インフラやAppの状況を可視化するためのデータであり、リクエスト駆動やキューイングサービスごとに収集するべき指標が異なる。リクエスト駆動であればRED（R:Request/処理数)(E:Errors/エラー数)(D:Duration/処理時間)を収集することが多く、キューイングサービスであれば<a class="reference external" href="https://www.brendangregg.com/usemethod.html">USE</a>(U:Utilization:タスク処理数)(S:Saturation:キューイング数)(E:Errors/エラー数)を利用することが多い。</p>
</section>
</section>
<section id="id5">
<h2><span class="section-number">1.2. </span>モダンアプリケーションパターン<a class="headerlink" href="#id5" title="この見出しへのパーマリンク">¶</a></h2>
<p>モダンAppを開発、構築する上での課題を解決するようなベストプラクティスパターンを紹介する</p>
<section id="spa-single-page-application">
<h3><span class="section-number">1.2.1. </span>SPA(Single Page Application)<a class="headerlink" href="#spa-single-page-application" title="この見出しへのパーマリンク">¶</a></h3>
<p>バックエンドがAPI化されたことを利用して、フロントエンドの画面描画を短縮するための技術。
静的コンテンツ(frontend)と動的コンテンツ(backend)を分割することで、</p>
</section>
<section id="bff">
<h3><span class="section-number">1.2.2. </span>BFF<a class="headerlink" href="#bff" title="この見出しへのパーマリンク">¶</a></h3>
<p>APIを集約して、単一の問合せにすると問合せが複雑になってしまう課題が存在する。
それに対して、問合せと返り値を整形して返してくれる集約してくれるBFFを適用する。</p>
</section>
<section id="id6">
<h3><span class="section-number">1.2.3. </span>メッセージング<a class="headerlink" href="#id6" title="この見出しへのパーマリンク">¶</a></h3>
<p>キューイングサービスを利用することで、サービス間を疎結合にする。</p>
</section>
<section id="saga">
<h3><span class="section-number">1.2.4. </span>Saga<a class="headerlink" href="#saga" title="この見出しへのパーマリンク">¶</a></h3>
<p>非同期通信における<code class="docutils literal notranslate"><span class="pre">サービスにまたがったデータの整合性を維持する</span></code></p>
<p>モノリスの場合は、データベースに対して、ロールバックをすれば良いがマイクロサービスなどの複数サービスが関わる場合、DBもそれぞれのサービスが扱うため、データの整合性を担保する仕組みが必要となる。</p>
<p>この課題に対して、補償トランザクション用のエンドポイントを用意しておき、別サービスからコミットを取り消せるようにしておく。
保証の方法は、中央集権的に管理するオーケストレーション方式と、各サービスが独立的に保証するコレオグラフィ方式（ダンスの振付）がある。</p>
<ul class="simple">
<li><p>オーケストレーション<br />オーケストレーター（指揮者）がサービスの実行を中堅集権的に監視して処理の判断を進める<br />例えば、Step-Functionを利用した管理はオーケストレーションの方式の一例</p></li>
<li><p>コレオグラフィ<br />それぞれのサービスを指揮する役割はなく、各自が独立しして自律的に協調的な処理を行う。
ロールバックが必要な場合はサービスが責任を持って、別サービスに対してロールバックの処理を依頼する。</p></li>
</ul>
</section>
<section id="cqrs">
<h3><span class="section-number">1.2.5. </span>CQRS<a class="headerlink" href="#cqrs" title="この見出しへのパーマリンク">¶</a></h3>
<p>アクセスパターンやユースケースの違いに対応するために、データ登録(Command)とデータ参照(Query)の責任を分離する（Responsibility Segregation）考え方。
分離することで、それぞれの特徴に合った別のDBを選択するような選択肢を取ることもできる。</p>
<p>CQRSの例として、データ登録先はDynamoDBにしておき、そのデータをDynamoDB StreamsでRDSに登録して、データ参照はRDSから刺せるような方式が挙げられる。</p>
</section>
<section id="id7">
<h3><span class="section-number">1.2.6. </span>イベントソーシング<a class="headerlink" href="#id7" title="この見出しへのパーマリンク">¶</a></h3>
<p>イベントをログとして耐久性のあるストレージに保存して、他のサービスから参照できるようにしておく。</p>
</section>
<section id="id8">
<h3><span class="section-number">1.2.7. </span>サーキットブレーカー<a class="headerlink" href="#id8" title="この見出しへのパーマリンク">¶</a></h3>
<p>同期的な通信において、障害が発生した場合に全体への影響を抑えるための機能。
例えば、連携先のサービスがサービスストップしていた場合に、検知できていないと呼び出し元がリトライをしたり、処理を待ってしまう。</p>
<p>連携先のサービスを監視しておいて、連携先の挙動に対して怪しければサーキットブレーカーが通信を止めて、元々設定していたエラー処理を返す。
あたかもブレーカーを落としたかのように処理を止めるのでサーキットブレーカーと呼ぶ。</p>
<p><img alt="../_images/circuit_breaker.png" src="../_images/circuit_breaker.png" /></p>
</section>
<section id="id9">
<h3><span class="section-number">1.2.8. </span>サービスディスカバリ<a class="headerlink" href="#id9" title="この見出しへのパーマリンク">¶</a></h3>
<p>サービスが増えてきたときに、毎回ALBを設定すると大変なので、サービスが立ち上がったときに「サービスレジストリ」に対して、接続先を登録する。
接続をしたいときには、サービスレジストリに問い合わせをして、接続先を調べる。</p>
<p>AWSで言うとCloud Mapというサービスディスカバリサービスを利用することで、ALBのようなリッチなサービスを利用せずに、シンプルにアプリケーションを構成することができる。</p>
<p><img alt="../_images/service_mesh.png" src="../_images/service_mesh.png" /></p>
</section>
<section id="id10">
<h3><span class="section-number">1.2.9. </span>サービスメッシュ<a class="headerlink" href="#id10" title="この見出しへのパーマリンク">¶</a></h3>
<p>前提として、ネットワークは信頼できないものである、という考えがある。
APIを呼び出すためには、リトライやヘルスチェック先ほど話したサーキットブレーカー、サービスディスカバリ、ログ機能などが必要となる。</p>
<p>サービスメッシュとは、これらの通信向けの共通機能を各アプリケーションに持たせるのではなくインフラ側が制御する方式である。</p>
<p>AWSではApp Meshと呼ばれるサービスがあり、OSSのEnvoyのフルマネージドサービスとなる。</p>
</section>
<section id="id11">
<h3><span class="section-number">1.2.10. </span>フィーチャーフラグ<a class="headerlink" href="#id11" title="この見出しへのパーマリンク">¶</a></h3>
<p>CICDの環境を構築するなどして、リリースの回数を増やしていき、提供スピードを上げることはモダンアプリケーションでは重要である。
リリースとブランチ戦略は密接に関連しており、mainブランチへの統合は短ければ短いほど、コンフリクトを減らし、整合性を高めることができる。
長命なブランチを許さないトランクベース開発が推奨されている。</p>
<p>フィーチャーフラグとは、リリースのタイミングで、サービスの変更を忍ばしておいて、フラグでコードを変更するだけで変更分をリリースするような方法で、ソースコード変更とリリースタイミングを調整する方法</p>
<p>AWSではAWS CloudWatch Evidentlyでフィーチャーフラグを管理することができる</p>
</section>
<section id="id12">
<h3><span class="section-number">1.2.11. </span>分散トレーシング<a class="headerlink" href="#id12" title="この見出しへのパーマリンク">¶</a></h3>
<p>マイクロサービスでは複数のサービスを跨いで、リクエストに紐づいた追跡が必要となる。</p>
<p>AWS X-RayやOpenTelemetryといったサービスがあり、以下のような単位でトレーシングを行う</p>
<ul class="simple">
<li><p>トレース：リクエストの一貫したトレーシング</p></li>
<li><p>セグメント：Appの処理した詳細</p></li>
<li><p>サブセグメント：Appがさらに他のサービスを呼び出した時のログ</p></li>
</ul>
<p><img alt="../_images/tracing.png" src="../_images/tracing.png" /></p>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../index.html">目次</a></h3>
    <ul>
<li><a class="reference internal" href="#">1. AWS</a><ul>
<li><a class="reference internal" href="#id1">1.1. モダンアプリケーション</a><ul>
<li><a class="reference internal" href="#id2">1.1.1. モダンアプリケーションのメリット</a></li>
<li><a class="reference internal" href="#id3">1.1.2. モダンなアプリケーションのベストプラクティス</a></li>
<li><a class="reference internal" href="#id4">1.1.3. データの可視化</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id5">1.2. モダンアプリケーションパターン</a><ul>
<li><a class="reference internal" href="#spa-single-page-application">1.2.1. SPA(Single Page Application)</a></li>
<li><a class="reference internal" href="#bff">1.2.2. BFF</a></li>
<li><a class="reference internal" href="#id6">1.2.3. メッセージング</a></li>
<li><a class="reference internal" href="#saga">1.2.4. Saga</a></li>
<li><a class="reference internal" href="#cqrs">1.2.5. CQRS</a></li>
<li><a class="reference internal" href="#id7">1.2.6. イベントソーシング</a></li>
<li><a class="reference internal" href="#id8">1.2.7. サーキットブレーカー</a></li>
<li><a class="reference internal" href="#id9">1.2.8. サービスディスカバリ</a></li>
<li><a class="reference internal" href="#id10">1.2.9. サービスメッシュ</a></li>
<li><a class="reference internal" href="#id11">1.2.10. フィーチャーフラグ</a></li>
<li><a class="reference internal" href="#id12">1.2.11. 分散トレーシング</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>前のトピックへ</h4>
    <p class="topless"><a href="../DAILY/FY23_MSA.html"
                          title="前の章へ"><span class="section-number">2. </span>塾の活動(FY23 上期)</a></p>
  </div>
  <div>
    <h4>次のトピックへ</h4>
    <p class="topless"><a href="Network.html"
                          title="次の章へ"><span class="section-number">2. </span>AWSのネットワーク</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>このページ</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/AWS/AWS.md.txt"
            rel="nofollow">ソースコードを表示</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">クイック検索</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="検索" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="総合索引"
             >索引</a></li>
        <li class="right" >
          <a href="Network.html" title="2. AWSのネットワーク"
             >次へ</a> |</li>
        <li class="right" >
          <a href="../DAILY/FY23_MSA.html" title="2. 塾の活動(FY23 上期)"
             >前へ</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">my_sphinx  ドキュメント</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href=""><span class="section-number">1. </span>AWS</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2022, sphinx_user.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.2.3.
    </div>
  </body>
</html>